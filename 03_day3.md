

``` python
```

    The autoreload extension is already loaded. To reload it, use:
      %reload_ext autoreload

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
from aoc2024.core import *
```

``` python
with open("../data/d3.txt", "r") as f:
    inp = f.read()

data = Parser(inp)
```

``` python
def d3(): return mapper(choice([
    sequence([digit(),digit(),digit()]),
    sequence([digit(),digit()]),
    sequence([digit()])]),[lambda x: int("".join(x))])
```

``` python
def mul(): return sequence([
    drop(satisfy(nchar(4),lambda x: x=="mul(")),
    d3(),
    drop(satisfy(char(),lambda x: x==",")),
    d3(),
    drop(satisfy(char(),lambda x: x==")"))
    ])
```

``` python
mul()(Parser('mul(32,4)'))
```

    (True,[32, 4],)

``` python
satisfy(nchar(3),lambda x: x=="mul")(Parser("multiple"))
```

    (True,mul,)

``` python
data.r()
r = many(find(mul()))(data)
sum(map(lambda x: x[0]*x[1],r.v))
```

    171183089

``` python
def tok_do(): return mapper(satisfy(nchar(4),lambda x: x == "do()"),[lambda x: Do()])
def tok_dont(): return mapper(satisfy(nchar(7), lambda x: x == "don't()"),[lambda x: Dont()])
def tok_mul(): return mapper(mul(),[lambda x: Mul(x[0],x[1])])
```

``` python
class d3_acc():
    def __init__(self):
        self.enabled=True
        self.v = 0

    def add(self,token): token.update(self)

class Do(): 
    def update(self,acc): acc.enabled=True
    def __repr__(self): return "DO"

class Dont():
    def update(self,acc): acc.enabled=False
    def __repr__(self): return "DONT"

class Mul:
    def __init__(self,x,y):
        self.v = x * y

    def update(self,acc):
        if acc.enabled: acc.v += self.v

    def __repr__(self): return f"MUL({self.v})"
```

``` python
def token(): return choice([tok_dont(),tok_do(),tok_mul()])
```

``` python
many(find(token()))(Parser("do()don't()mul(34,56)"))
```

    (True,[DO, DONT, MUL(1904)],)

``` python
data.r()
mapper(accumulator(find(token()),d3_acc()),[lambda x: x.v])(data)
```

    (True,63866497,)
